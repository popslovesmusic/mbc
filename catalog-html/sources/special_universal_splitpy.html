<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>universal_splitpy.md</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .header {
            background: #2d2d30;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .header h1 {
            margin: 0 0 5px 0;
            font-size: 18px;
            color: #4ec9b0;
        }
        .header .path {
            color: #858585;
            font-size: 12px;
        }
        .source-content {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            overflow: auto;
        }
        .line {
            display: flex;
            line-height: 1.6;
            min-height: 20px;
        }
        .line:target {
            background: #264f78;
        }
        .line:hover {
            background: #2a2d2e;
        }
        .line-number {
            flex-shrink: 0;
            width: 60px;
            padding: 2px 10px;
            text-align: right;
            color: #858585;
            border-right: 1px solid #3e3e42;
            user-select: none;
        }
        .line-content {
            flex: 1;
            padding: 2px 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Markdown syntax highlighting */
        .heading { color: #4ec9b0; font-weight: bold; }
        .bold { color: #dcdcaa; font-weight: bold; }
        .italic { color: #ce9178; font-style: italic; }
        .code { color: #ce9178; background: #2d2d30; padding: 2px 4px; }
        .link { color: #3794ff; }
        .list-marker { color: #569cd6; }
        .greek { color: #c586c0; }
        .math { color: #4fc1ff; }
    </style>
</head>
<body>
    <div class="header">
        <h1>universal_splitpy.md</h1>
        <div class="path">special\universal_splitpy.md</div>
    </div>
    <div class="source-content">
        <div class="line" id="L1"><span class="line-number">1</span><span class="line-content"><span class="heading">#!/usr/bin/env python3</span></span></div>
<div class="line" id="L2"><span class="line-number">2</span><span class="line-content">&quot;&quot;&quot;</span></div>
<div class="line" id="L3"><span class="line-number">3</span><span class="line-content">Universal Markdown Chapter Splitter</span></div>
<div class="line" id="L4"><span class="line-number">4</span><span class="line-content">Usage: python universal_split.py &lt;path_to_file_or_directory&gt;</span></div>
<div class="line" id="L5"><span class="line-number">5</span><span class="line-content">&quot;&quot;&quot;</span></div>
<div class="line" id="L6"><span class="line-number">6</span><span class="line-content"></span></div>
<div class="line" id="L7"><span class="line-number">7</span><span class="line-content">import os</span></div>
<div class="line" id="L8"><span class="line-number">8</span><span class="line-content">import re</span></div>
<div class="line" id="L9"><span class="line-number">9</span><span class="line-content">import sys</span></div>
<div class="line" id="L10"><span class="line-number">10</span><span class="line-content">import shutil</span></div>
<div class="line" id="L11"><span class="line-number">11</span><span class="line-content">import argparse</span></div>
<div class="line" id="L12"><span class="line-number">12</span><span class="line-content">from pathlib import Path</span></div>
<div class="line" id="L13"><span class="line-number">13</span><span class="line-content"></span></div>
<div class="line" id="L14"><span class="line-number">14</span><span class="line-content"><span class="heading"># Fix Windows console encoding issues</span></span></div>
<div class="line" id="L15"><span class="line-number">15</span><span class="line-content">if sys.platform == 'win32':</span></div>
<div class="line" id="L16"><span class="line-number">16</span><span class="line-content">    sys.stdout.reconfigure(encoding='utf-8')</span></div>
<div class="line" id="L17"><span class="line-number">17</span><span class="line-content"></span></div>
<div class="line" id="L18"><span class="line-number">18</span><span class="line-content">def extract_chapters(md_file_path):</span></div>
<div class="line" id="L19"><span class="line-number">19</span><span class="line-content">    &quot;&quot;&quot;Extract chapters from a markdown file based on level-1 headings.&quot;&quot;&quot;</span></div>
<div class="line" id="L20"><span class="line-number">20</span><span class="line-content">    try:</span></div>
<div class="line" id="L21"><span class="line-number">21</span><span class="line-content">        with open(md_file_path, 'r', encoding='utf-8') as f:</span></div>
<div class="line" id="L22"><span class="line-number">22</span><span class="line-content">            content = f.read()</span></div>
<div class="line" id="L23"><span class="line-number">23</span><span class="line-content">    except Exception as e:</span></div>
<div class="line" id="L24"><span class="line-number">24</span><span class="line-content">        print(f&quot;Error reading {md_file_path}: {e}&quot;)</span></div>
<div class="line" id="L25"><span class="line-number">25</span><span class="line-content">        return []</span></div>
<div class="line" id="L26"><span class="line-number">26</span><span class="line-content"></span></div>
<div class="line" id="L27"><span class="line-number">27</span><span class="line-content"><span class="heading">    # Regex for Level 1 headers (# Title)</span></span></div>
<div class="line" id="L28"><span class="line-number">28</span><span class="line-content">    pattern = r'^# (.+)$'</span></div>
<div class="line" id="L29"><span class="line-number">29</span><span class="line-content">    matches = list(re.finditer(pattern, content, re.MULTILINE))</span></div>
<div class="line" id="L30"><span class="line-number">30</span><span class="line-content"></span></div>
<div class="line" id="L31"><span class="line-number">31</span><span class="line-content">    if not matches:</span></div>
<div class="line" id="L32"><span class="line-number">32</span><span class="line-content">        print(f&quot;  [!] No chapters (Level-1 Headers) found in {md_file_path.name}&quot;)</span></div>
<div class="line" id="L33"><span class="line-number">33</span><span class="line-content">        return []</span></div>
<div class="line" id="L34"><span class="line-number">34</span><span class="line-content"></span></div>
<div class="line" id="L35"><span class="line-number">35</span><span class="line-content">    chapters = []</span></div>
<div class="line" id="L36"><span class="line-number">36</span><span class="line-content">    for i, match in enumerate(matches):</span></div>
<div class="line" id="L37"><span class="line-number">37</span><span class="line-content">        title = match.group(1).strip()</span></div>
<div class="line" id="L38"><span class="line-number">38</span><span class="line-content">        start_pos = match.start()</span></div>
<div class="line" id="L39"><span class="line-number">39</span><span class="line-content"></span></div>
<div class="line" id="L40"><span class="line-number">40</span><span class="line-content"><span class="heading">        # Find end position (start of next chapter or end of file)</span></span></div>
<div class="line" id="L41"><span class="line-number">41</span><span class="line-content">        if i &lt; len(matches) - 1:</span></div>
<div class="line" id="L42"><span class="line-number">42</span><span class="line-content">            end_pos = matches[i + 1].start()</span></div>
<div class="line" id="L43"><span class="line-number">43</span><span class="line-content">        else:</span></div>
<div class="line" id="L44"><span class="line-number">44</span><span class="line-content">            end_pos = len(content)</span></div>
<div class="line" id="L45"><span class="line-number">45</span><span class="line-content"></span></div>
<div class="line" id="L46"><span class="line-number">46</span><span class="line-content">        chapter_content = content[start_pos:end_pos].strip()</span></div>
<div class="line" id="L47"><span class="line-number">47</span><span class="line-content">        chapters.append({</span></div>
<div class="line" id="L48"><span class="line-number">48</span><span class="line-content">            'title': title,</span></div>
<div class="line" id="L49"><span class="line-number">49</span><span class="line-content">            'content': chapter_content,</span></div>
<div class="line" id="L50"><span class="line-number">50</span><span class="line-content">            'number': i + 1</span></div>
<div class="line" id="L51"><span class="line-number">51</span><span class="line-content">        })</span></div>
<div class="line" id="L52"><span class="line-number">52</span><span class="line-content"></span></div>
<div class="line" id="L53"><span class="line-number">53</span><span class="line-content">    return chapters</span></div>
<div class="line" id="L54"><span class="line-number">54</span><span class="line-content"></span></div>
<div class="line" id="L55"><span class="line-number">55</span><span class="line-content">def sanitize_filename(title):</span></div>
<div class="line" id="L56"><span class="line-number">56</span><span class="line-content">    &quot;&quot;&quot;Convert chapter title to safe filename.&quot;&quot;&quot;</span></div>
<div class="line" id="L57"><span class="line-number">57</span><span class="line-content">    title = re.sub(r'\<span class="italic">*\*</span>', '', title) # Remove bold</span></div>
<div class="line" id="L58"><span class="line-number">58</span><span class="line-content">    title = re.sub(r'[&lt;&gt;:&quot;/\\|?*]', '', title) # Remove illegal chars</span></div>
<div class="line" id="L59"><span class="line-number">59</span><span class="line-content">    title = title.replace(' ', '_') # Spaces to underscores</span></div>
<div class="line" id="L60"><span class="line-number">60</span><span class="line-content">    return title[:100] # Limit length</span></div>
<div class="line" id="L61"><span class="line-number">61</span><span class="line-content"></span></div>
<div class="line" id="L62"><span class="line-number">62</span><span class="line-content">def create_summary(output_dir, source_file, chapter_info):</span></div>
<div class="line" id="L63"><span class="line-number">63</span><span class="line-content">    &quot;&quot;&quot;Create a summary/index file for the directory.&quot;&quot;&quot;</span></div>
<div class="line" id="L64"><span class="line-number">64</span><span class="line-content">    summary_path = output_dir / &quot;00_INDEX.md&quot;</span></div>
<div class="line" id="L65"><span class="line-number">65</span><span class="line-content">    with open(summary_path, 'w', encoding='utf-8') as f:</span></div>
<div class="line" id="L66"><span class="line-number">66</span><span class="line-content">        f.write(f&quot;# Index: {source_file}\n\n&quot;)</span></div>
<div class="line" id="L67"><span class="line-number">67</span><span class="line-content">        f.write(f&quot;<span class="bold">*<span class="italic">*Total Chapters:*</span>*</span> {len(chapter_info)}\n\n&quot;)</span></div>
<div class="line" id="L68"><span class="line-number">68</span><span class="line-content">        f.write(&quot;---\n\n&quot;)</span></div>
<div class="line" id="L69"><span class="line-number">69</span><span class="line-content">        f.write(&quot;## Chapter List\n\n&quot;)</span></div>
<div class="line" id="L70"><span class="line-number">70</span><span class="line-content">        for ch in chapter_info:</span></div>
<div class="line" id="L71"><span class="line-number">71</span><span class="line-content">            f.write(f&quot;{ch['number']}. <span class="bold">*<span class="italic">*{ch['title']}*</span>*</span>\n&quot;)</span></div>
<div class="line" id="L72"><span class="line-number">72</span><span class="line-content">            f.write(f&quot;   - File: <span class="code">`{ch['filename']}`</span>\n\n&quot;)</span></div>
<div class="line" id="L73"><span class="line-number">73</span><span class="line-content">    print(f&quot;  âœ“ Created index: {summary_path.name}&quot;)</span></div>
<div class="line" id="L74"><span class="line-number">74</span><span class="line-content"></span></div>
<div class="line" id="L75"><span class="line-number">75</span><span class="line-content">def process_single_file(md_file, output_root):</span></div>
<div class="line" id="L76"><span class="line-number">76</span><span class="line-content">    &quot;&quot;&quot;Process a single markdown file.&quot;&quot;&quot;</span></div>
<div class="line" id="L77"><span class="line-number">77</span><span class="line-content">    </span></div>
<div class="line" id="L78"><span class="line-number">78</span><span class="line-content"><span class="heading">    # 1. Determine Output Directory</span></span></div>
<div class="line" id="L79"><span class="line-number">79</span><span class="line-content"><span class="heading">    # Creates a folder named after the file (e.g., &quot;MyBook.md&quot; -&gt; &quot;MyBook/&quot;)</span></span></div>
<div class="line" id="L80"><span class="line-number">80</span><span class="line-content">    dest_dir = output_root / md_file.stem</span></div>
<div class="line" id="L81"><span class="line-number">81</span><span class="line-content"></span></div>
<div class="line" id="L82"><span class="line-number">82</span><span class="line-content"><span class="heading">    # 2. Clean/Create Directory</span></span></div>
<div class="line" id="L83"><span class="line-number">83</span><span class="line-content">    if dest_dir.exists():</span></div>
<div class="line" id="L84"><span class="line-number">84</span><span class="line-content"><span class="heading">        # Safely remove old version to ensure clean extraction</span></span></div>
<div class="line" id="L85"><span class="line-number">85</span><span class="line-content">        shutil.rmtree(dest_dir)</span></div>
<div class="line" id="L86"><span class="line-number">86</span><span class="line-content">    dest_dir.mkdir(parents=True, exist_ok=True)</span></div>
<div class="line" id="L87"><span class="line-number">87</span><span class="line-content"></span></div>
<div class="line" id="L88"><span class="line-number">88</span><span class="line-content">    print(f&quot;\nProcessing: {md_file.name}&quot;)</span></div>
<div class="line" id="L89"><span class="line-number">89</span><span class="line-content">    print(f&quot;Target:     {dest_dir}&quot;)</span></div>
<div class="line" id="L90"><span class="line-number">90</span><span class="line-content">    print(f&quot;{'-'*60}&quot;)</span></div>
<div class="line" id="L91"><span class="line-number">91</span><span class="line-content"></span></div>
<div class="line" id="L92"><span class="line-number">92</span><span class="line-content"><span class="heading">    # 3. Extract</span></span></div>
<div class="line" id="L93"><span class="line-number">93</span><span class="line-content">    chapters = extract_chapters(md_file)</span></div>
<div class="line" id="L94"><span class="line-number">94</span><span class="line-content">    </span></div>
<div class="line" id="L95"><span class="line-number">95</span><span class="line-content">    if not chapters:</span></div>
<div class="line" id="L96"><span class="line-number">96</span><span class="line-content">        return 0</span></div>
<div class="line" id="L97"><span class="line-number">97</span><span class="line-content"></span></div>
<div class="line" id="L98"><span class="line-number">98</span><span class="line-content"><span class="heading">    # 4. Save Chapters</span></span></div>
<div class="line" id="L99"><span class="line-number">99</span><span class="line-content">    chapter_info = []</span></div>
<div class="line" id="L100"><span class="line-number">100</span><span class="line-content">    for chapter in chapters:</span></div>
<div class="line" id="L101"><span class="line-number">101</span><span class="line-content">        safe_title = sanitize_filename(chapter['title'])</span></div>
<div class="line" id="L102"><span class="line-number">102</span><span class="line-content">        filename = f&quot;Chapter_{chapter['number']:02d}_{safe_title}.md&quot;</span></div>
<div class="line" id="L103"><span class="line-number">103</span><span class="line-content">        filepath = dest_dir / filename</span></div>
<div class="line" id="L104"><span class="line-number">104</span><span class="line-content"></span></div>
<div class="line" id="L105"><span class="line-number">105</span><span class="line-content">        with open(filepath, 'w', encoding='utf-8') as f:</span></div>
<div class="line" id="L106"><span class="line-number">106</span><span class="line-content">            f.write(chapter['content'])</span></div>
<div class="line" id="L107"><span class="line-number">107</span><span class="line-content"></span></div>
<div class="line" id="L108"><span class="line-number">108</span><span class="line-content">        chapter_info.append({</span></div>
<div class="line" id="L109"><span class="line-number">109</span><span class="line-content">            'number': chapter['number'],</span></div>
<div class="line" id="L110"><span class="line-number">110</span><span class="line-content">            'title': chapter['title'],</span></div>
<div class="line" id="L111"><span class="line-number">111</span><span class="line-content">            'filename': filename</span></div>
<div class="line" id="L112"><span class="line-number">112</span><span class="line-content">        })</span></div>
<div class="line" id="L113"><span class="line-number">113</span><span class="line-content">        print(f&quot;  [{chapter['number']:02d}] {chapter['title'][:60]}&quot;)</span></div>
<div class="line" id="L114"><span class="line-number">114</span><span class="line-content"></span></div>
<div class="line" id="L115"><span class="line-number">115</span><span class="line-content"><span class="heading">    # 5. Create Index</span></span></div>
<div class="line" id="L116"><span class="line-number">116</span><span class="line-content">    create_summary(dest_dir, md_file.name, chapter_info)</span></div>
<div class="line" id="L117"><span class="line-number">117</span><span class="line-content">    return len(chapters)</span></div>
<div class="line" id="L118"><span class="line-number">118</span><span class="line-content"></span></div>
<div class="line" id="L119"><span class="line-number">119</span><span class="line-content">def main():</span></div>
<div class="line" id="L120"><span class="line-number">120</span><span class="line-content">    parser = argparse.ArgumentParser(description=&quot;Split Markdown files by Level-1 Headers.&quot;)</span></div>
<div class="line" id="L121"><span class="line-number">121</span><span class="line-content">    parser.add_argument(&quot;input_path&quot;, help=&quot;Path to a single .md file OR a folder containing .md files&quot;)</span></div>
<div class="line" id="L122"><span class="line-number">122</span><span class="line-content">    parser.add_argument(&quot;-o&quot;, &quot;--output&quot;, help=&quot;Optional custom output directory (default: same as input)&quot;, default=None)</span></div>
<div class="line" id="L123"><span class="line-number">123</span><span class="line-content">    </span></div>
<div class="line" id="L124"><span class="line-number">124</span><span class="line-content">    args = parser.parse_args()</span></div>
<div class="line" id="L125"><span class="line-number">125</span><span class="line-content">    </span></div>
<div class="line" id="L126"><span class="line-number">126</span><span class="line-content">    input_path = Path(args.input_path)</span></div>
<div class="line" id="L127"><span class="line-number">127</span><span class="line-content">    </span></div>
<div class="line" id="L128"><span class="line-number">128</span><span class="line-content"><span class="heading">    # Determine Output Root</span></span></div>
<div class="line" id="L129"><span class="line-number">129</span><span class="line-content">    if args.output:</span></div>
<div class="line" id="L130"><span class="line-number">130</span><span class="line-content">        output_root = Path(args.output)</span></div>
<div class="line" id="L131"><span class="line-number">131</span><span class="line-content">    else:</span></div>
<div class="line" id="L132"><span class="line-number">132</span><span class="line-content"><span class="heading">        # If no output specified, use the parent of the file or the folder itself</span></span></div>
<div class="line" id="L133"><span class="line-number">133</span><span class="line-content">        output_root = input_path.parent if input_path.is_file() else input_path</span></div>
<div class="line" id="L134"><span class="line-number">134</span><span class="line-content"></span></div>
<div class="line" id="L135"><span class="line-number">135</span><span class="line-content">    files_to_process = []</span></div>
<div class="line" id="L136"><span class="line-number">136</span><span class="line-content"></span></div>
<div class="line" id="L137"><span class="line-number">137</span><span class="line-content"><span class="heading">    # Logic to handle File vs Directory</span></span></div>
<div class="line" id="L138"><span class="line-number">138</span><span class="line-content">    if input_path.is_file():</span></div>
<div class="line" id="L139"><span class="line-number">139</span><span class="line-content">        if input_path.suffix.lower() == '.md':</span></div>
<div class="line" id="L140"><span class="line-number">140</span><span class="line-content">            files_to_process.append(input_path)</span></div>
<div class="line" id="L141"><span class="line-number">141</span><span class="line-content">        else:</span></div>
<div class="line" id="L142"><span class="line-number">142</span><span class="line-content">            print(&quot;Error: Input file must be a .md file.&quot;)</span></div>
<div class="line" id="L143"><span class="line-number">143</span><span class="line-content">            return</span></div>
<div class="line" id="L144"><span class="line-number">144</span><span class="line-content">    elif input_path.is_dir():</span></div>
<div class="line" id="L145"><span class="line-number">145</span><span class="line-content">        print(f&quot;Scanning directory: {input_path}&quot;)</span></div>
<div class="line" id="L146"><span class="line-number">146</span><span class="line-content">        files_to_process = list(input_path.glob(&quot;*.md&quot;))</span></div>
<div class="line" id="L147"><span class="line-number">147</span><span class="line-content">    else:</span></div>
<div class="line" id="L148"><span class="line-number">148</span><span class="line-content">        print(f&quot;Error: Path not found: {input_path}&quot;)</span></div>
<div class="line" id="L149"><span class="line-number">149</span><span class="line-content">        return</span></div>
<div class="line" id="L150"><span class="line-number">150</span><span class="line-content"></span></div>
<div class="line" id="L151"><span class="line-number">151</span><span class="line-content">    if not files_to_process:</span></div>
<div class="line" id="L152"><span class="line-number">152</span><span class="line-content">        print(&quot;No .md files found to process.&quot;)</span></div>
<div class="line" id="L153"><span class="line-number">153</span><span class="line-content">        return</span></div>
<div class="line" id="L154"><span class="line-number">154</span><span class="line-content"></span></div>
<div class="line" id="L155"><span class="line-number">155</span><span class="line-content">    print(f&quot;{'='*60}&quot;)</span></div>
<div class="line" id="L156"><span class="line-number">156</span><span class="line-content">    print(f&quot;Found {len(files_to_process)} files to process.&quot;)</span></div>
<div class="line" id="L157"><span class="line-number">157</span><span class="line-content">    print(f&quot;{'='*60}&quot;)</span></div>
<div class="line" id="L158"><span class="line-number">158</span><span class="line-content"></span></div>
<div class="line" id="L159"><span class="line-number">159</span><span class="line-content">    total_chapters = 0</span></div>
<div class="line" id="L160"><span class="line-number">160</span><span class="line-content">    for md_file in files_to_process:</span></div>
<div class="line" id="L161"><span class="line-number">161</span><span class="line-content">        total_chapters += process_single_file(md_file, output_root)</span></div>
<div class="line" id="L162"><span class="line-number">162</span><span class="line-content"></span></div>
<div class="line" id="L163"><span class="line-number">163</span><span class="line-content">    print(f&quot;\n{'='*60}&quot;)</span></div>
<div class="line" id="L164"><span class="line-number">164</span><span class="line-content">    print(f&quot;COMPLETE. Extracted {total_chapters} chapters total.&quot;)</span></div>
<div class="line" id="L165"><span class="line-number">165</span><span class="line-content">    print(f&quot;{'='*60}&quot;)</span></div>
<div class="line" id="L166"><span class="line-number">166</span><span class="line-content"></span></div>
<div class="line" id="L167"><span class="line-number">167</span><span class="line-content"><span class="heading">    # Keep window open if running from double-click/bat</span></span></div>
<div class="line" id="L168"><span class="line-number">168</span><span class="line-content">    if sys.platform == 'win32':</span></div>
<div class="line" id="L169"><span class="line-number">169</span><span class="line-content">        input(&quot;\nPress Enter to exit...&quot;)</span></div>
<div class="line" id="L170"><span class="line-number">170</span><span class="line-content"></span></div>
<div class="line" id="L171"><span class="line-number">171</span><span class="line-content">if __name__ == &quot;__main__&quot;:</span></div>
<div class="line" id="L172"><span class="line-number">172</span><span class="line-content">    main()</span></div>
    </div>
</body>
</html>